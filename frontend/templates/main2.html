{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MisiónEmprende UDD - El Juego</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- FontAwesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts: Montserrat (Textos) y Russo One (Títulos Gamer) -->
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Russo+One&display=swap" rel="stylesheet">
    <!-- CSS Personalizado -->
    <link rel="stylesheet" href="{% static 'misionemprende/css/main2.css' %}">
</head>
<body class="flex flex-col">

    <!-- Header Global Gamer -->
    <header class="bg-gray-900 bg-opacity-90 backdrop-filter backdrop-blur-lg shadow-lg sticky top-0 z-40 border-b border-gray-800">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            
            <!-- LOGOS INTEGRADOS -->
            <div class="flex items-center space-x-2">
                <!-- Contenedor Logos -->
                <div class="flex items-center space-x-3">
                        <img src="{% static 'misionemprende/img/ShlamS.png' %}" 
                         alt="Logo ShlamS" 
                         class="h-11 w-auto opacity-90 hover:opacity-100 transition"
                         onclick="app.attemptGoHome()">
                    
                    <!-- Signo + -->
                    <span class="text-gray-400 text-xl font-bold">+</span>
                    
                    <!-- Logo UDD (Con fallback a URL pública si no encuentra el archivo local) -->
                    <img src="{% static 'misionemprende/img/image.png' %}" 
                         onerror="this.src='https://admision.udd.cl/wp-content/themes/udd-admision/assets/images/logo-udd-blanco.svg'" 
                         alt="Logo UDD" 
                         class="h-14 w-auto opacity-90 hover:opacity-100 transition">
                </div>

                <!-- Título -->
                <h1 class="text-xl text-white hidden md:block tracking-wider border-l-2 border-gray-600 pl-4">Misión<span class="text-pink-500">Emprende</span></h1>
            </div>
                <div id="team-display" class="hidden text-sm font-semibold text-gray-300">
                    Equipo: <span id="team-name-display" class="text-pink-500 uppercase">---</span>
                </div>
            <div class="flex items-center space-x-4">
                <!-- Token Counter Animado -->
                <div class="token-badge px-4 py-2 rounded-full text-lg font-bold shadow-lg flex items-center transform transition hover:scale-110">
                    <i class="fas fa-coins mr-2 animate-pulse"></i> <span id="token-count">0</span>
                </div>
                <div id="global-timer" class="hidden bg-red-600 text-white px-4 py-2 rounded-lg font-mono text-xl font-bold border-2 border-red-400 shadow-lg animate-pulse">
                    00:00
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow container mx-auto px-4 py-8 max-w-6xl relative">
        
        <!-- Notificaciones Toast Gamer -->
        <div id="toast" class="fixed top-24 right-4 bg-gradient-to-r from-green-400 to-blue-500 text-white px-6 py-4 rounded-xl shadow-2xl transform translate-x-full transition-transform duration-500 z-[200] flex items-center border-2 border-white">
            <i class="fas fa-check-circle text-2xl mr-3"></i>
            <span id="toast-message" class="font-bold text-lg">Mensaje</span>
        </div>

        <!-- Overlay de Cuenta Regresiva Dramática -->
        <div id="dramatic-countdown" class="hidden fixed inset-0 bg-gray-900 bg-opacity-95 z-[100] flex flex-col items-center justify-center">
            <h2 class="text-white gamer-font text-3xl mb-4 animate-bounce">¡Prepárense!</h2>
            <div id="countdown-number" class="text-white gamer-font text-[15rem] leading-none animate-pulse text-shadow-lg">3</div>
        </div>

        <!-- Overlay de Transición por Fin de Fase (Nuevo) -->
        <div id="phase-transition-overlay" class="hidden fixed inset-0 bg-gray-900 bg-opacity-95 z-[100] flex flex-col items-center justify-center p-4 text-center">
            <h2 class="text-white gamer-font text-5xl mb-6 text-yellow-400 animate-bounce">¡TIEMPO AGOTADO!</h2>
            <p class="text-gray-300 text-xl mb-8">Las palabras correctas eran: <span id="correct-words-display" class="font-bold text-pink-500"></span>.</p>
            <p class="text-white text-3xl font-bold mb-4">Continuando la Misión en...</p>
            <div id="transition-countdown-number" class="text-white gamer-font text-[8rem] leading-none animate-pulse text-shadow-lg">10</div>
        </div>

        <!-- 1. PANTALLA DE BIENVENIDA (REDDISEÑADA) -->
        <section id="view-welcome" class="active fade-in text-center py-6">
            
            <!-- Hero Title -->
            <div class="mb-10 animate-bounce-slow">
                <h1 class="text-5xl md:text-7xl font-bold text-white mb-2 gamer-font drop-shadow-lg">Misión<span class="text-pink-500">Emprende</span></h1>
                <p class="text-gray-300 text-xl tracking-widest uppercase">Entrenamiento de Habilidades Emprendedoras</p>
            </div>

            <!-- Visual Flow (Diagrama Simplificado) -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-5xl mx-auto mb-12">
                <!-- Paso 1 -->
                <div class="bg-gray-800/50 backdrop-blur-sm border-2 border-pink-500/30 p-6 rounded-2xl transform hover:scale-105 transition duration-300">
                    <div class="w-20 h-20 bg-pink-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-[0_0_20px_rgba(212,15,125,0.5)]">
                        <i class="fas fa-users text-4xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 gamer-font">1. Arma tu equipo</h3>
                    <p class="text-gray-400 text-sm">Conéctate con tu equipo y prepárate para aprender jugando.</p>
                </div>

                <!-- Paso 2 -->
                <div class="bg-gray-800/50 backdrop-blur-sm border-2 border-blue-500/30 p-6 rounded-2xl transform hover:scale-105 transition duration-300 relative">
                    <!-- Flecha conectora (Solo desktop) -->
                    <i class="fas fa-chevron-right absolute -left-5 top-1/2 transform -translate-y-1/2 text-2xl text-gray-600 hidden md:block"></i>
                    
                    <div class="w-20 h-20 bg-blue-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-[0_0_20px_rgba(59,130,246,0.5)]">
                        <i class="fas fa-lightbulb text-4xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 gamer-font">2. Supera desafíos</h3>
                    <p class="text-gray-400 text-sm">Compañerismo, Empatía, Creatividad y Pitch. Resuelve retos reales contrarreloj.</p>
                </div>

                <!-- Paso 3 -->
                <div class="bg-gray-800/50 backdrop-blur-sm border-2 border-yellow-500/30 p-6 rounded-2xl transform hover:scale-105 transition duration-300 relative">
                    <!-- Flecha conectora (Solo desktop) -->
                    <i class="fas fa-chevron-right absolute -left-5 top-1/2 transform -translate-y-1/2 text-2xl text-gray-600 hidden md:block"></i>

                    <div class="w-20 h-20 bg-yellow-500 rounded-full flex items-center justify-center mx-auto mb-4 shadow-[0_0_20px_rgba(234,179,8,0.5)]">
                        <i class="fas fa-coins text-4xl text-white"></i>
                    </div>
                    <h3 class="text-xl font-bold text-white mb-2 gamer-font">3. Gana Tokens</h3>
                    <p class="text-gray-400 text-sm">Acumula recompensas por desempeño y compite con los otros equipos.</p>
                </div>
            </div>

            <!-- Botón de Inicio Principal (Alumnos) -->
            <button onclick="app.playSound('click'); app.showView('view-login')" class="udd-gradient text-white font-bold text-3xl py-6 px-16 rounded-full shadow-[0_0_30px_rgba(212,15,125,0.6)] hover:shadow-[0_0_50px_rgba(212,15,125,0.8)] transform transition hover:scale-105 active:scale-95 border-4 border-white/10 group mb-12">
                <span class="flex items-center gap-4 gamer-font">
                    <i class="fas fa-play-circle"></i> INICIAR JUEGO
                </span>
            </button>

            <!--admin y profe -->
            <div class="max-w-4xl mx-auto border-t border-gray-700 pt-8">
                <p class="text-gray-500 text-sm uppercase tracking-widest mb-4 font-bold">Accesos especiales</p>
                <div class="flex justify-center gap-4">
                    <button onclick="app.showView('view-professor'); app.initProfessorView()" 
                        class="bg-gray-800 hover:bg-gray-700 text-gray-300 hover:text-white px-6 py-3 rounded-lg border border-gray-600 transition flex items-center gap-2">
                        <i class="fas fa-chalkboard-teacher text-yellow-400"></i> Acceso Profesor
                    </button>
                    <button onclick="app.showView('view-admin-login')" class="bg-gray-800 hover:bg-gray-700 text-gray-300 hover:text-white px-6 py-3 rounded-lg border border-gray-600 transition flex items-center gap-2">
                        <i class="fas fa-chart-line text-blue-400"></i> Administrador
                    </button>
                </div>
            </div>
                <div class="flex items-center space-x-1 justify-center">
                    <h3 class="text-xl md:text-xl font-bold text-white mb-1 gamer-font drop-shadow-lg">Creado <span class="text-gray-500">por</span></h3>

                    <img src="{% static 'misionemprende/img/shlam.png' %}" 
                            alt="Logo ShlamFull" 
                            class="h-24 w-auto opacity-90 hover:opacity-100 transition">
                </div>
            </div>
        </section>

        <!-- PANTALLA ADMINISTRADOR (NUEVA) -->
        <section id="view-admin-login" class="hidden fade-in min-h-screen flex items-center justify-center relative overflow-hidden">
            <div class="absolute inset-0 bg-gray-900">
                <div class="absolute inset-0 opacity-20" style="background-image: linear-gradient(#333 1px, transparent 1px), linear-gradient(90deg, #333 1px, transparent 1px); background-size: 30px 30px;"></div>
            </div>
        
            <div class="bg-gray-800/90 backdrop-blur-md p-10 rounded-3xl shadow-[0_0_50px_rgba(0,0,0,0.5)] border border-gray-700 w-full max-w-md relative z-10 text-center">
                <div class="mb-8">
                    <i class="fas fa-user-shield text-6xl text-pink-500 mb-4 animate-pulse"></i>
                    <h2 class="text-3xl text-white font-bold gamer-font">Acceso Restringido</h2>
                    <p class="text-gray-400 text-sm mt-2">Identifícate para acceder al Mainframe</p>
                </div>
        
                <div class="space-y-4 text-left">
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase ml-1">Usuario</label>
                        <div class="relative">
                            <i class="fas fa-user absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                            <input type="text" id="admin-user" class="w-full bg-gray-900 border border-gray-600 text-white pl-12 pr-4 py-3 rounded-xl focus:border-pink-500 focus:ring-1 focus:ring-pink-500 transition outline-none" placeholder="Ingresa usuario">
                        </div>
                    </div>
                    <div>
                        <label class="text-xs font-bold text-gray-500 uppercase ml-1">Contraseña</label>
                        <div class="relative">
                            <i class="fas fa-lock absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-500"></i>
                            <input type="password" id="admin-pass" class="w-full bg-gray-900 border border-gray-600 text-white pl-12 pr-4 py-3 rounded-xl focus:border-pink-500 focus:ring-1 focus:ring-pink-500 transition outline-none" placeholder="••••••••">
                        </div>
                    </div>
                </div>
        
                <button onclick="app.adminLogin()" class="mt-8 w-full udd-gradient text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-pink-500/40 hover:scale-105 transition">
                    <i class="fas fa-unlock mr-2"></i> INICIAR SESIÓN
                </button>
                
                <button onclick="app.showView('view-welcome')" class="mt-4 text-gray-500 text-sm hover:text-white transition">
                    <i class="fas fa-arrow-left"></i> Volver al inicio
                </button>
            </div>
        </section>

        <section id="view-admin-dashboard" class="hidden fade-in min-h-screen bg-gray-900 pb-10">
            <div class="bg-gray-800 border-b border-gray-700 p-6 flex justify-between items-center sticky top-0 z-50 shadow-lg">
                <div class="flex items-center gap-4">
                    <div class="w-12 h-12 bg-pink-600 rounded-lg flex items-center justify-center text-white shadow-lg">
                        <i class="fas fa-database text-2xl"></i>
                    </div>
                    <div>
                        <h2 class="text-2xl text-white font-bold gamer-font">Base de Datos de Escuadrones</h2>
                        <p class="text-gray-400 text-xs font-mono uppercase tracking-widest">Estado del servidor: <span class="text-green-400">EN LÍNEA</span></p>
                    </div>
                </div>
                <button onclick="app.showView('view-welcome')" class="bg-gray-700 hover:bg-red-600 text-white px-4 py-2 rounded-lg transition text-sm font-bold">
                    <i class="fas fa-power-off mr-2"></i> Cerrar Sesión
                </button>
            </div>
        
            <div class="max-w-7xl mx-auto p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                    <div class="bg-gray-800 p-6 rounded-2xl border-l-4 border-blue-500 shadow-lg">
                        <h3 class="text-gray-400 text-xs font-bold uppercase">Equipos Registrados</h3>
                        <p id="admin-total-teams" class="text-4xl text-white font-bold gamer-font">0</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-2xl border-l-4 border-purple-500 shadow-lg">
                        <h3 class="text-gray-400 text-xs font-bold uppercase">Estudiantes Totales</h3>
                        <p id="admin-total-agents" class="text-4xl text-white font-bold gamer-font">0</p>
                    </div>
                    <div class="bg-gray-800 p-6 rounded-2xl border-l-4 border-green-500 shadow-lg">
                        <h3 class="text-gray-400 text-xs font-bold uppercase">Sesión Activa</h3>
                        <p class="text-4xl text-white font-bold gamer-font">LIVE</p>
                    </div>
                </div>
        
                <div id="admin-teams-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    </div>
            </div>
        </section>

         <!-- 1.5 SELECCIÓN DE ROL -->
         <!-- ... (Contenido de selección de rol omitido para brevedad, no hay cambios aquí) ... -->
         <section id="view-roles" class="fade-in text-center">
            <h2 class="text-3xl text-white gamer-font mb-2">Elige tu Rol Inicial</h2>
            <p class="text-gray-300 mb-8">Cada gran equipo necesita especialistas. ¿Quién eres tú?</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- Rol 1: El Visionario (Hustler) -->
                <div onclick="app.selectRole('Visionario')" class="game-card p-6 cursor-pointer group hover:bg-pink-50">
                    <div class="h-32 w-32 mx-auto bg-gradient-to-br from-yellow-400 to-orange-500 rounded-full flex items-center justify-center mb-4 shadow-lg group-hover:scale-110 transition">
                        <i class="fas fa-bullhorn text-5xl text-white"></i>
                    </div>
                    <h3 class="font-bold text-xl mb-2 gamer-font">El Visionario</h3>
                    <p class="text-sm text-gray-600">Vendes la idea. Lideras el pitch. Convences al mundo.</p>
                </div>
                <!-- Rol 2: El Constructor (Hacker) -->
                <div onclick="app.selectRole('Constructor')" class="game-card p-6 cursor-pointer group hover:bg-blue-50">
                    <div class="h-32 w-32 mx-auto bg-gradient-to-br from-blue-400 to-indigo-500 rounded-full flex items-center justify-center mb-4 shadow-lg group-hover:scale-110 transition">
                        <i class="fas fa-cogs text-5xl text-white"></i>
                    </div>
                    <h3 class="font-bold text-xl mb-2 gamer-font">El Constructor</h3>
                    <p class="text-sm text-gray-600">Haces que funcione. Prototipas. Resuelves lo técnico.</p>
                </div>
                <!-- Rol 3: El Empático (Hipster) -->
                <div onclick="app.selectRole('Empatico')" class="game-card p-6 cursor-pointer group hover:bg-green-50">
                    <div class="h-32 w-32 mx-auto bg-gradient-to-br from-green-400 to-teal-500 rounded-full flex items-center justify-center mb-4 shadow-lg group-hover:scale-110 transition">
                        <i class="fas fa-heart text-5xl text-white"></i>
                    </div>
                    <h3 class="font-bold text-xl mb-2 gamer-font">El Empático</h3>
                    <p class="text-sm text-gray-600">Entiendes al usuario. Diseñas la experiencia. Conectas emociones.</p>
                </div>
            </div>
        </section>

        <!-- 2. LOGIN Y REGISTRO DE EQUIPO (MEJORA RESPONSIVE) -->
        <section id="view-login" class="fade-in">
            <div class="game-card p-8 sm:p-12">
                <div class="flex justify-between items-center mb-6 border-b pb-4">
                    <h3 class="text-2xl font-bold text-gray-800 gamer-font">Registro de equipo</h3>
                </div>
                
                <div class="mb-6 flex flex-col md:flex-row gap-10">
                    <div class="w-full md:w-2/3">
                        <label class="block text-gray-700 font-bold mb-2 uppercase text-sm tracking-wider">Nombre del Equipo</label>
                        <input type="text" id="input-team-name" maxlength="30" class="w-full p-4 border-2 border-gray-300 bg-white rounded-xl focus:border-pink-500 focus:ring-4 focus:ring-pink-200 transition text-lg font-bold text-gray-800" placeholder="Ej: Team Estrellita">
                    </div>
                    <div class="w-full md:w-1/3">
                        <label class="block text-gray-700 font-bold mb-2 uppercase text-sm tracking-wider">Código de Sesión</label>
                        <input type="text" id="input-code" maxlength="6" oninput="this.value = this.value.toUpperCase();" class="w-full p-4 border-2 border-gray-300 bg-white rounded-xl focus:border-pink-500 focus:ring-4 focus:ring-pink-200 transition text-lg font-bold text-gray-800" placeholder="Ej: AB1234">
                    </div>
                </div>
                    <div class="mb-8">
                    <div class="flex justify-between items-center mb-2">
                        <label class="block text-gray-700 font-bold uppercase text-sm tracking-wider">Integrantes (Máx 8)</label>
                        <span id="member-count" class="bg-pink-100 text-pink-800 text-xs font-bold px-2 py-1 rounded-full">0/8</span>
                    </div>
                    
                    <div id="members-list" class="space-y-2 mb-4 max-h-48 overflow-y-auto p-2 bg-gray-50 rounded-xl">
                        <!-- Lista dinámica -->
                    </div>

                    <!-- MEJORA RESPONSIVE: gap-2 en móvil, md:flex-row en tablet/desktop -->
                    <div class="flex flex-col md:flex-row gap-2 bg-white p-2 rounded-xl shadow-inner border">
                        <input type="text" id="input-member-name" class="flex-grow p-3 bg-white border-none focus:ring-0 text-gray-800 font-semibold" placeholder="Nombre ">
                        <select id="input-member-career" class="p-3 border-l bg-transparent text-gray-600 text-sm font-semibold focus:ring-0 md:border-l md:w-auto w-full">
                            <option value="">Especialidad...</option>
                            <option value="Ingeniería">Ingeniería</option>
                            <option value="Diseño">Diseño</option>
                            <option value="Salud">Salud</option>
                            <option value="Negocios">Negocios</option>
                            <option value="Otra">Otra</option>
                        </select>
                        <button onclick="app.playSound('click'); app.addMember()" class="udd-gradient text-white w-full md:w-12 h-12 rounded-lg hover:bg-gray-700 flex items-center justify-center text-xl font-bold shadow transition hover:scale-105">+</button>
                    </div>
                </div>

                <div class="bg-yellow-100 p-4 rounded-xl mb-6 border-l-8 border-yellow-400 flex items-start">
                    <i class="fas fa-satellite-dish text-yellow-600 text-xl mr-3 mt-1 animate-pulse"></i>
                    <p class="text-sm text-yellow-800 font-semibold">Esperando sincronización global. La misión comenzará cuando todos los escuadrones estén listos.</p>
                </div>

                <button onclick="enviarEquipoAlBackend(); app.finishLogin()" class="udd-gradient w-full text-white font-bold text-xl py-4 rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] transition disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100" id="btn-start-game">
                    <i class="fas fa-check-circle mr-2"></i> Confirmar y Esperar
                </button>
            </div>
        </section>




        <!-- 3. Preinicio (selección) -->
        <section id="view-stage1-intro" class="fade-in text-center pt-6">
             <!-- ... (Contenido de intro Etapa 1 omitido para brevedad, no hay cambios aquí) ... -->
             <span class="bg-blue-500 text-white text-xs font-bold uppercase px-3 py-1 rounded-full mb-4 inline-block shadow-lg">Trabajo en equipo</span>
            <h2 class="text-4xl font-bold text-white mb-4 gamer-font text-shadow">Juego entre pares</h2>
            <p class="text-gray-300 mt-2 mb-10 text-xl max-w-2xl mx-auto">La confianza es su mejor arma. ¿Cuál es el estado actual del equipo?</p>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 max-w-3xl mx-auto">
                <!-- Opción 1 -->
                <button onclick="app.playSound('click'); app.triggerDramaticCountdown('known')" class="game-card p-8 hover:border-pink-500 group text-left relative overflow-hidden">
                     <div class="absolute top-0 right-0 -mt-4 -mr-4 bg-pink-100 h-24 w-24 rounded-full opacity-50 transition group-hover:scale-150 group-hover:bg-pink-200"></div>
                    <i class="fas fa-users text-5xl text-pink-500 mb-4 relative z-10"></i>
                    <h3 class="font-bold text-2xl gamer-font text-gray-800 relative z-10">Ya nos conocemos</h3>
                    <p class="text-gray-600 mt-2 relative z-10 font-semibold">Juego de agilidad mental en equipo</p>
                </button>
                <!-- Opción 2 -->
                <button onclick="app.playSound('click'); app.triggerDramaticCountdown('unknown')" class="game-card p-8 hover:border-blue-500 group text-left relative overflow-hidden">
                    <div class="absolute top-0 right-0 -mt-4 -mr-4 bg-blue-100 h-24 w-24 rounded-full opacity-50 transition group-hover:scale-150 group-hover:bg-blue-200"></div>
                    <i class="fas fa-handshake text-5xl text-blue-500 mb-4 relative z-10"></i>
                    <h3 class="font-bold text-2xl gamer-font text-gray-800 relative z-10">No nos conocemos</h3>
                    <p class="text-gray-600 mt-2 relative z-10 font-semibold">Juego Rompehielos o:</p>
                </button>
            </div>
        </section>

        <!-- 3.1 Rompehielo-->
        <section id="icebreaker" class="w-full max-w-lg mx-auto text-center pt-6">
        <div class="mb-8">
            <h2 class="white-text text-3xl font-bold gamer-font mb-2">Rompehielos <i class="fas fa-snowflake text-pink-500 animate-pulse"></i></h2>
            <p class="text-gray-200">Conoce a tu grupo primero</p>
        </div>

        <div id="card-container" class="relative min-h-[200px] mb-8 perspective-1000">
            
            <div id="question-card" class="game-card bg-white p-8 border-2 border-gray-100 flex flex-col items-center justify-center h-full min-h-[240px] relative overflow-hidden group">
                <!-- Decoración de fondo -->
                <div class="absolute top-0 right-0 w-32 h-32 bg-pink-50 rounded-full -mr-10 -mt-10 transition-transform group-hover:scale-110"></div>
                <div class="absolute bottom-0 left-0 w-24 h-24 bg-purple-50 rounded-full -ml-10 -mb-10 transition-transform group-hover:scale-110"></div>
                
                <i class="fas fa-comments text-4xl text-pink-400 mb-4 relative z-10"></i>
                
                <!-- Texto de la pregunta -->
                <h3 id="pregunta-texto" class="text-2xl font-bold text-left text-gray-800 relative z-10 px-4 leading-relaxed">
                    En este juego deben preguntarse aquellas frases que aparezcan. 
                    ¿Todos listos?
                </h3>
                
                <!-- Contador de cartas restantes -->
                <span id="counter" class="absolute bottom-4 right-4 text-xs font-bold text-gray-400 uppercase tracking-widest bg-gray-100 px-2 py-1 rounded">
                    Mazo lleno
                </span>
            </div>
        </div>

        <!-- Controles -->
        <div class="controls-area h-32 flex flex-col items-center justify-center">
            
            <!-- Botón para sacar carta (Se oculta al final) -->
            <button id="btn-draw" onclick="drawCard()" class="bg-gray-900 text-white px-8 py-4 rounded-2xl font-bold text-lg hover:bg-pink-600 hover:scale-105 transition-all shadow-[0_0_25px_5px_rgba(236,72,153,0.9)] flex items-center gap-3">
                <i class="fas fa-random"></i> Sacar Carta
            </button>

            <!-- TU CÓDIGO: Botón de siguiente fase (Oculto inicialmente) -->
            <div id="next-stage-btn" class="hidden w-full fade-in">
                <button onclick="app.playSound('click'); app.completeStage1()" class="game-card w-full p-6 border-2 border-pink-100 hover:border-pink-500 group text-left relative overflow-hidden transition-all duration-300">
                    <div class="absolute top-0 right-0 -mt-4 -mr-4 bg-pink-100 h-24 w-24 rounded-full opacity-50 transition group-hover:scale-150 group-hover:bg-pink-200"></div>
                    <div class="flex items-center gap-4 relative z-10">
                        <div class="bg-pink-500 text-white w-12 h-12 rounded-full flex items-center justify-center text-xl shadow-lg group-hover:rotate-12 transition">
                            <i class="fas fa-users"></i>
                        </div>
                        <div>
                            <h3 class="font-bold text-xl gamer-font text-gray-800">Ya nos conocemos</h3>
                            <p class="text-gray-600 text-sm font-semibold">Vamos al siguiente desafío</p>
                        </div>
                        <i class="fas fa-arrow-right ml-auto text-pink-300 group-hover:text-pink-600 transition-transform group-hover:translate-x-1"></i>
                    </div>
                </button> 
            </div>

            <!-- Mensaje de fin (Opcional, pequeño texto antes de dar clic al botón grande) -->
            <p id="completion-msg" class="hidden text-sm text-pink-500 font-bold mt-2 animate-bounce">
                ¡Preguntas finalizadas!
            </p>
        </div>
        </section>

        <!--- Minijuego -->
        <section id="view-stage1-game" class="fade-in py-8">
            <div class="game-card p-6 text-center max-w-2xl mx-auto border-t-8 border-pink-500">
                <h3 id="stage1-title" class="text-3xl font-bold mb-4 gamer-font text-gray-800">Dinámica</h3>
                <p id="stage1-desc" class="text-lg text-gray-600 mb-8 font-semibold"></p>

                <!-- Mini Juego: Sopa de Letras -->
                <div id="game-container" class="mb-8 p-6 bg-gray-800 rounded-2xl shadow-inner">
                    <p class="mb-4 font-bold text-white uppercase tracking-wider"><i class="fas fa-search mr-2"></i> Palabras Detectadas:</p>
                    <div class="flex justify-center space-x-4 mb-4" id="target-words-display">
                        <span id="word-target-INNOVAR" class="bg-pink-600 text-white px-3 py-1 rounded-full text-xs font-bold transition">INNOVAR</span>
                        <span id="word-target-EQUIPO" class="bg-pink-600 text-white px-3 py-1 rounded-full text-xs font-bold transition">EQUIPO</span>
                        <span id="word-target-LIDER" class="bg-pink-600 text-white px-3 py-1 rounded-full text-xs font-bold transition">LIDER</span>
                    </div>
                    <div class="word-grid" id="word-grid">
                        <!-- Generado por JS -->
                    </div>
                </div>

                <button id="btn-complete-stage1" onclick="app.completeStage1()" class="udd-gradient text-white font-bold text-xl py-3 px-10 rounded-full shadow-lg opacity-50 cursor-not-allowed transition" disabled>
                    ¡Misión Cumplida!
                </button>
            </div>
            
            <div class="mt-6 bg-blue-900 bg-opacity-50 p-4 rounded-xl border-l-4 border-blue-400 max-w-2xl mx-auto backdrop-filter backdrop-blur">
                <h4 class="font-bold text-blue-300 text-sm uppercase"><i class="fas fa-database mr-2"></i> Dato Freak</h4>
                <p class="text-sm text-gray-300 mt-1 font-semibold">La cohesión del grupo es crítica. Un equipo conectado reacciona 40% más rápido ante imprevistos.</p>
            </div>
        </section>

        <!-- 4. ETAPA 2: TEMAS (8 MIN) -->
        <section id="view-stage2-topics" class="fade-in text-center pt-6">
            <span class="text-pink-500 font-bold tracking-[0.2em] text-sm uppercase mb-2 block animate-pulse">Empatía</span>
            <!--- <span class="bg-purple-500 text-white text-xs font-bold uppercase px-3 py-1 rounded-full mb-4 inline-block shadow-lg">Etapa 2: Empatía</span> -->
            <h2 class="text-4xl font-bold text-white mb-4 gamer-font text-shadow">Selecciona alguna problemática</h2>
            <p class="text-gray-300 mt-2 mb-10 text-xl">¿De qué tema te gustaría indagar?</p>


            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Tarjeta 1: Tecnología adultos mayores -->
                <div onclick="app.playSound('click'); app.selectTopic('adultos_mayores')" class="game-card cursor-pointer overflow-hidden group hover:border-yellow-500">
                    <div class="h-40 bg-gradient-to-br from-yellow-400 to-orange-500 flex items-center justify-center transform group-hover:scale-110 transition duration-500">
                        <i class="fas fa-mobile-alt text-6xl text-white drop-shadow-lg"></i>
                    </div>
                    <div class="p-6 relative">
                         <div class="absolute top-0 right-0 mt-[-20px] mr-4 bg-white p-2 rounded-full shadow-lg">
                            <i class="fas fa-users text-yellow-500 text-2xl"></i>
                        </div>
                        <h3 class="font-bold text-xl mb-2 gamer-font text-gray-800">Tecnología y adultos mayores</h3>
                        <p class="text-sm text-gray-600 font-semibold">Brecha digital intergeneracional.</p>
                    </div>
                </div>
                <!-- Tarjeta 2: Fastfashion y desechos -->
                 <div onclick="app.playSound('click'); app.selectTopic('fastfashion_desechos')" class="game-card cursor-pointer overflow-hidden group hover:border-red-500">
                    <div class="h-40 bg-gradient-to-br from-red-400 to-pink-600 flex items-center justify-center transform group-hover:scale-110 transition duration-500">
                        <i class="fas fa-dumpster text-6xl text-white drop-shadow-lg"></i>
                    </div>
                    <div class="p-6 relative">
                         <div class="absolute top-0 right-0 mt-[-20px] mr-4 bg-white p-2 rounded-full shadow-lg">
                            <i class="fas fa-trash-alt text-red-500 text-2xl"></i>
                        </div>
                        <h3 class="font-bold text-xl mb-2 gamer-font text-gray-800">Fastfashion y zonas de desechos</h3>
                        <p class="text-sm text-gray-600 font-semibold">Impacto ambiental y social de la moda rápida.</p>
                    </div>
                </div>
                <!-- Tarjeta 3: Sustentabilidad del agua -->
                 <div onclick="app.playSound('click'); app.selectTopic('sustentabilidad_agua')" class="game-card cursor-pointer overflow-hidden group hover:border-blue-500">
                    <div class="h-40 bg-gradient-to-br from-blue-400 to-cyan-600 flex items-center justify-center transform group-hover:scale-110 transition duration-500">
                        <i class="fas fa-water text-6xl text-white drop-shadow-lg animate-pulse-slow"></i>
                    </div>
                    <div class="p-6 relative">
                        <div class="absolute top-0 right-0 mt-[-20px] mr-4 bg-white p-2 rounded-full shadow-lg">
                            <i class="fas fa-seedling text-blue-500 text-2xl"></i>
                        </div>
                        <h3 class="font-bold text-xl mb-2 gamer-font text-gray-800">Sustentabilidad del agua en la agricultura</h3>
                        <p class="text-sm text-gray-600 font-semibold">Optimización del recurso hídrico en zonas rurales.</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- NUEVA VISTA: SELECCIÓN DE PERSONA (CASO ESPECÍFICO) -->
        <section id="view-stage2-persona-select" class="fade-in py-8 hidden">
            <div class="max-w-6xl mx-auto w-full px-4 mb-2">
                <button onclick="app.playSound('click'); app.showView('view-stage2-topics')" 
                    class="group flex items-center text-gray-400 hover:text-white transition-colors duration-300 font-bold tracking-wider text-sm uppercase">
                    <div class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center mr-3 group-hover:bg-pink-600 transition-colors">
                        <i class="fas fa-arrow-left"></i>
                    </div>
                    Volver a Categorías
                </button>
            </div>
        
            <div class="text-center mb-12 relative">
                <span class="text-pink-500 font-bold tracking-[0.2em] text-sm uppercase mb-2 block animate-pulse">Empatía</span>
                <h2 id="persona-select-title" class="text-4xl md:text-5xl font-bold text-white mb-4 gamer-font drop-shadow-lg">
                    Ahora selecciona una persona
                </h2>
                <div class="w-24 h-1 bg-gradient-to-r from-transparent via-pink-500 to-transparent mx-auto rounded-full"></div>
                <p class="text-gray-300 mt-6 text-lg max-w-2xl mx-auto leading-relaxed">
                    Analiza los casos disponibles. <span class="text-white font-bold">Elige sabiamente</span>, esta decisión definirá el resto del juego.
                </p>
            </div>
        
            <div class="max-w-7xl mx-auto w-full px-4 pb-20">
                <div id="persona-list" class="grid grid-cols-1 md:grid-cols-3 gap-8 items-start">
                    </div>
            </div>
        </section>

        <!-- 4.5 ETAPA 2: DETALLE DEL DESAFÍO (MAPA DE EMPATÍA) -->
        <section id="view-stage2-challenge-detail" class="fade-in py-6 w-3/4 mx-auto">
            <div class="game-card p-6 border-t-8 border-purple-500">
                

                <h4 class="font-bold text-center mb-2 mt-4 text-4xl gamer-font text-gray-800">Bubble Map</h4>
                <p class="text-lg text-center mb-6 font-semibold">
                    <span class="text-gray-500">Haz clic en alguna </span>
                    <span class="text-purple-500 font-bold">burbuja</span>
                    <span class="text-gray-500"> para colocar una característica que debe tener tu personaje.</span>
                </p>

                <div class="flex flex-col md:flex-row items-start md:items-center gap-6 mb-8 bg-purple-50 p-6 rounded-2xl border-2 border-purple-200">
                    <div id="persona-icon-large" class="bg-gradient-to-br from-purple-400 to-pink-500 w-24 h-24 rounded-2xl flex-shrink-0 flex items-center justify-center shadow-lg rotate-3">
                        <i class="fas fa-user-astronaut text-5xl text-white"></i>
                    </div>
                    <div>
                        <h4 class="text-sm text-purple-600 font-bold uppercase tracking-wider mb-1">Recuerda a tu persona elegida y su caso</h4>
                        <h3 id="persona-name-map" class="text-3xl font-bold text-gray-800 gamer-font mb-2">Nombre del Sujeto</h3>
                        <p id="persona-problem-map" class="text-sm text-gray-700 font-semibold">"Descripción del problema crítico que enfrenta..."</p>
                    </div>
                </div>

                <div class="bubble-container bg-slate-100 rounded-2xl border-4 border-dashed border-gray-300 mb-8 shadow-inner overflow-hidden relative">
                    <!-- Fondo de rejilla táctica -->
                    <div class="absolute inset-0 opacity-10" style="background-image: radial-gradient(circle, #aaa 1px, transparent 1px); background-size: 20px 20px;"></div>
                    
                    <div id="bubble-center-user" class="bubble-center gamer-font tracking-wider text-lg shadow-xl border-4 border-white">USUARIO</div>
                    
                    <!-- Nodos inputs con estilo (8 Nodos) -->
                    <div class="bubble-node pos-1 hover:shadow-xl"><textarea placeholder="Característica 1"></textarea></div>
                    <div class="bubble-node pos-2 hover:shadow-xl"><textarea placeholder="Característica 2"></textarea></div>
                    <div class="bubble-node pos-3 hover:shadow-xl"><textarea placeholder="Característica 3"></textarea></div>
                    <div class="bubble-node pos-4 hover:shadow-xl"><textarea placeholder="Característica 4"></textarea></div>
                    <div class="bubble-node pos-5 hover:shadow-xl"><textarea placeholder="Característica 5"></textarea></div>
                    <div class="bubble-node pos-6 hover:shadow-xl"><textarea placeholder="Característica 6"></textarea></div>
                    <div class="bubble-node pos-7 hover:shadow-xl"><textarea placeholder="Característica 7"></textarea></div>
                    <div class="bubble-node pos-8 hover:shadow-xl"><textarea placeholder="Característica 8"></textarea></div>
                </div>

                <button onclick="app.playSound('success'); app.completeStage2()" class="udd-gradient w-full text-white font-bold text-xl py-4 rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] transition flex items-center justify-center">
                    <i class="fas fa-save mr-3"></i> Guardar y Avanzar
                </button>
            </div>
        </section>

        <!-- 5. ETAPA 3: CREATIVIDAD (10 MIN) -->
        <!-- ... (Contenido de Etapa 3 omitido para brevedad, no hay cambios aquí) ... -->
        <section id="view-stage3" class="fade-in text-center pt-6">
            <span class="bg-green-500 text-white text-xs font-bold uppercase px-3 py-1 rounded-full mb-4 inline-block shadow-lg">Etapa 3: Prototipado Rápido</span>
            <h2 class="text-4xl font-bold text-white mb-4 gamer-font text-shadow">Fase de Construcción</h2>
            
            <div class="game-card p-8 mb-8 border-t-8 border-green-500 relative overflow-hidden">
                 <!-- Icono de fondo gigante -->
                <i class="fas fa-cubes text-[15rem] absolute -top-20 -left-20 text-green-100 opacity-50 z-0 rotate-12"></i>
                
                <div class="relative z-10">
                    <div class="flex items-center justify-center mb-6">
                        <div class="bg-yellow-400 p-4 rounded-full shadow-lg animate-bounce-slow">
                             <i class="fas fa-lego text-5xl text-yellow-800"></i>
                        </div>
                    </div>
                    <h3 class="text-3xl font-bold text-center mb-4 gamer-font text-gray-800">¡A los ladrillos!</h3>
                    <p class="text-gray-600 text-center mb-8 text-lg font-semibold">Usen el LEGO físico para construir una solución tangible. No piensen, ¡hagan!</p>

                    <div class="w-full bg-red-100 p-4 rounded-xl border-l-4 border-red-400 mb-6 text-left relative">
                        <h5 class="text-red-800 font-bold flex items-left"><i class="fas fa-map-marker-alt mr-2"></i> Recuerden su protagonista:</h5>
                        <h3 id='stage3-persona-name'class="text-3xl font-bold text-gray-900 gamer-font mb-2">Nombre del Sujeto</h3>
                        <p id='stage3-problem-summary' class="text-s text-red-900 mt-2">"Descripción del problema crítico que enfrenta..."</p>
                    </div>

                    <div class="bg-yellow-50 p-6 rounded-2xl border-2 border-yellow-300 mb-8 shadow-md text-left relative">
                         <div class="absolute -top-4 -left-4 bg-yellow-400 text-yellow-900 p-2 rounded-lg font-bold shadow-sm rotate-[-10deg]">
                            <i class="fas fa-bolt"></i> Ayuda
                        </div>
                        <h4 class="font-bold text-yellow-800 uppercase tracking-wider mb-2 ml-4">Ideas para empezar:</h4>
                        <p id="creative-prompt" class="italic text-xl text-gray-800 font-bold">"¿Y si la solución tuviera que caber en un bolsillo?"</p>
                        <button onclick="app.playSound('click'); app.newPrompt()" class="mt-4 text-sm text-pink-600 font-bold hover:text-pink-800 flex items-center"><i class="fas fa-sync-alt mr-2 spin-on-hover"></i> Generar nuevo modificador</button>
                    </div>

                    <div class="border-4 border-dashed border-gray-300 rounded-2xl p-8 text-center hover:bg-gray-50 transition cursor-pointer group" onclick="app.playSound('click'); document.getElementById('file-upload').click()">
                        <i class="fas fa-camera-retro text-5xl text-gray-400 mb-4 group-hover:text-pink-500 transition group-hover:scale-110"></i>
                        <p class="text-lg font-bold text-gray-600 group-hover:text-gray-800">Subir Evidencia Fotográfica (Opcional)</p>
                        <p class="text-sm text-gray-400">Click para capturar el prototipo</p>
                        <input type="file" id="file-upload" class="hidden" accept="image/*">
                    </div>
                </div>
            </div>

            <button onclick="app.playSound('success'); app.completeStage3()" class="udd-gradient w-full md:w-2/3 text-white font-bold text-xl py-4 rounded-full shadow-lg hover:shadow-pink-500/50 hover:scale-105 transition">
                <i class="fas fa-rocket mr-3"></i> Prototipo Terminado
            </button>
        </section>

        <!-- 6. ETAPA 4: COMUNICACIÓN (6 MIN) -->
        <!-- ... (Contenido de Etapa 4 omitido para brevedad, no hay cambios aquí) ... -->
        <section id="view-stage4" class="fade-in text-center pt-6">
             <span class="bg-red-500 text-white text-xs font-bold uppercase px-3 py-1 rounded-full mb-4 inline-block shadow-lg">Etapa 4: El Pitch Final</span>
            <h2 class="text-4xl font-bold text-white mb-6 gamer-font text-shadow">Vender la Misión</h2>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-8 items-stretch">
                <!-- Guía Táctica con INPUTS -->
                <div class="game-card p-8 text-left border-t-8 border-red-500 h-full overflow-y-auto max-h-[600px]">
                    <h3 class="font-bold text-2xl mb-6 gamer-font text-gray-800"><i class="fas fa-clipboard-list mr-3 text-red-500"></i>Estructura</h3>
                    <ul class="space-y-6 text-gray-700 font-semibold">
                        <li class="bg-red-50 p-4 rounded-lg shadow-sm">
                            <div class="flex items-start mb-2">
                                <i class="fas fa-check-square text-red-500 mt-1 mr-3 text-xl"></i>
                                <div><strong class="text-red-700">1. El Gancho:</strong><br><span class="text-sm">Captura su atención en 5 segundos. Dato impactante o historia breve.</span></div>
                            </div>
                            <textarea class="w-full mt-2 p-3 border-2 border-red-200 rounded-lg focus:border-red-500 focus:outline-none text-gray-800 text-sm" rows="2" placeholder="Escribe tu gancho aquí..."></textarea>
                        </li>
                        <li class="bg-red-50 p-4 rounded-lg shadow-sm">
                            <div class="flex items-start mb-2">
                                <i class="fas fa-check-square text-red-500 mt-1 mr-3 text-xl"></i>
                                <div><strong class="text-red-700">2. El Dolor (Empatía):</strong><br><span class="text-sm">¿Quién sufre y por qué? Muestra que entiendes el problema.</span></div>
                            </div>
                            <textarea class="w-full mt-2 p-3 border-2 border-red-200 rounded-lg focus:border-red-500 focus:outline-none text-gray-800 text-sm" rows="2" placeholder="Describe el dolor del usuario..."></textarea>
                        </li>
                        <li class="bg-red-50 p-4 rounded-lg shadow-sm">
                            <div class="flex items-start mb-2">
                                <i class="fas fa-check-square text-red-500 mt-1 mr-3 text-xl"></i>
                                <div><strong class="text-red-700">3. El Arma (Solución):</strong><br><span class="text-sm">¡Muestra el LEGO! Explica cómo tu prototipo resuelve el dolor.</span></div>
                            </div>
                            <textarea class="w-full mt-2 p-3 border-2 border-red-200 rounded-lg focus:border-red-500 focus:outline-none text-gray-800 text-sm" rows="2" placeholder="Explica tu solución..."></textarea>
                        </li>
                         <li class="bg-red-50 p-4 rounded-lg shadow-sm">
                            <div class="flex items-start mb-2">
                                <i class="fas fa-check-square text-red-500 mt-1 mr-3 text-xl"></i>
                                <div><strong class="text-red-700">4. El Cierre (Call to Action):</strong><br><span class="text-sm">Una frase memorable que invite a unirse a la causa.</span></div>
                            </div>
                            <textarea class="w-full mt-2 p-3 border-2 border-red-200 rounded-lg focus:border-red-500 focus:outline-none text-gray-800 text-sm" rows="2" placeholder="Escribe tu frase de cierre..."></textarea>
                        </li>
                    </ul>
                </div>

                <!-- Centro de Control -->
                <div class="game-card p-8 flex flex-col justify-center items-center bg-gray-800 text-white border-4 border-gray-700 h-full relative overflow-hidden">
                     <div class="absolute inset-0 opacity-20 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]"></div>
                    <div class="text-center mb-8 relative z-10">
                        <p class="text-gray-400 text-sm font-bold uppercase tracking-widest mb-2"><i class="fas fa-stopwatch mr-2"></i> Tiempo de Preparación</p>
                        <!-- Timer Local de Preparación (Visual) -->
                        <div id="prep-timer-display" class="text-6xl font-mono font-bold text-red-400 text-shadow-lg bg-black bg-opacity-50 px-6 py-2 rounded-xl border-2 border-red-900">06:00</div>
                    </div>
                    
                    <button onclick="app.playSound('click'); app.startPitchMode()" class="bg-red-600 text-white font-bold text-2xl py-4 px-10 rounded-full hover:bg-red-700 w-full mb-4 shadow-lg hover:shadow-red-500/50 transform transition hover:scale-105 relative z-10 flex items-center justify-center group">
                        <i class="fas fa-broadcast-tower mr-4 group-hover:animate-pulse"></i> INICIAR TRANSMISIÓN (90s)
                    </button>
                    <p class="text-sm text-gray-400 font-semibold relative z-10">Solo presionar cuando el equipo esté en posición.</p>
                </div>
            </div>

            <!-- Modal de Pitch Gamer -->
            <div id="pitch-overlay" class="hidden fixed inset-0 bg-gray-900 z-[100] flex flex-col items-center justify-center text-white bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
                <div class="absolute inset-0 bg-gradient-to-b from-red-900 via-transparent to-black opacity-80"></div>
                <div class="relative z-10 text-center">
                    <div class="animate-pulse mb-8">
                         <i class="fas fa-circle text-red-500 mr-2 text-xl"></i> <span class="text-red-500 font-bold tracking-wider uppercase">En Vivo</span>
                    </div>
                    <h2 class="text-5xl font-bold mb-6 gamer-font text-shadow-lg">¡ESTÁN EN EL AIRE!</h2>
                    <div class="bg-black bg-opacity-50 p-8 rounded-3xl border-4 border-red-600 shadow-2xl mb-10">
                        <div id="pitch-timer" class="text-[10rem] font-mono font-bold text-white leading-none text-shadow-xl">01:30</div>
                    </div>
                    <button onclick="app.playSound('click'); app.endPitch()" class="bg-transparent border-4 border-white text-white font-bold text-xl px-12 py-4 rounded-full hover:bg-white hover:text-black transition uppercase tracking-wider">
                        <i class="fas fa-stop-circle mr-3"></i> Terminar Transmisión
                    </button>
                </div>
            </div>
        </section>

        <!-- 7. ETAPA 5: EVALUACIÓN -->
        <!-- ... (Contenido de Etapa 5 omitido para brevedad, no hay cambios aquí) ... -->
        <section id="view-stage5" class="fade-in py-8">
            <div class="game-card p-8 max-w-3xl mx-auto border-t-8 border-yellow-500">
                 <h2 class="text-3xl font-bold mb-2 gamer-font text-gray-800 text-center">Evaluación entre Pares</h2>
                 <p class="text-center text-gray-600 mb-8 font-semibold bg-yellow-100 py-2 rounded-lg">
                    <i class="fas fa-info-circle mr-2"></i>Evalúen objetivamente al grupo: <strong>"Equipo Estrellita"</strong>
                </p>

                <div class="space-y-8">
                    <!-- Slider Gamer 1 -->
                    <div class="bg-gray-50 p-4 rounded-xl border-2 border-gray-200">
                        <label class="flex justify-between font-bold text-gray-700 mb-4 uppercase text-sm tracking-wider">
                            <span><i class="fas fa-users mr-2 text-yellow-500"></i>Coordinación de Equipo</span>
                            <span class="text-yellow-600 font-black" id="val-1">3/5</span>
                        </label>
                        <input type="range" class="w-full h-4 bg-gray-300 rounded-full appearance-none cursor-pointer accent-yellow-500" min="1" max="5" step="1" value="3" oninput="document.getElementById('val-1').innerText = this.value + '/5'">
                        <div class="flex justify-between text-xs text-gray-500 mt-2 font-bold uppercase"><span>Novatos</span><span>Élite</span></div>
                    </div>
                     <!-- Slider Gamer 2 -->
                    <div class="bg-gray-50 p-4 rounded-xl border-2 border-gray-200">
                        <label class="flex justify-between font-bold text-gray-700 mb-4 uppercase text-sm tracking-wider">
                             <span><i class="fas fa-heart mr-2 text-pink-500"></i>Nivel de Empatía</span>
                            <span class="text-pink-600 font-black" id="val-2">3/5</span>
                        </label>
                        <input type="range" class="w-full h-4 bg-gray-300 rounded-full appearance-none cursor-pointer accent-pink-500" min="1" max="5" step="1" value="3" oninput="document.getElementById('val-2').innerText = this.value + '/5'">
                         <div class="flex justify-between text-xs text-gray-500 mt-2 font-bold uppercase"><span>Superficial</span><span>Profundo</span></div>
                    </div>
                    <!-- Slider Gamer 3 -->
                     <div class="bg-gray-50 p-4 rounded-xl border-2 border-gray-200">
                        <label class="flex justify-between font-bold text-gray-700 mb-4 uppercase text-sm tracking-wider">
                             <span><i class="fas fa-lightbulb mr-2 text-blue-500"></i>Creatividad e Innovación</span>
                            <span class="text-blue-600 font-black" id="val-3">3/5</span>
                        </label>
                        <input type="range" class="w-full h-4 bg-gray-300 rounded-full appearance-none cursor-pointer accent-blue-500" min="1" max="5" step="1" value="3" oninput="document.getElementById('val-3').innerText = this.value + '/5'">
                         <div class="flex justify-between text-xs text-gray-500 mt-2 font-bold uppercase"><span>Convencional</span><span>Disruptivo</span></div>
                    </div>
                     <!-- Slider Gamer 4 -->
                     <div class="bg-gray-50 p-4 rounded-xl border-2 border-gray-200">
                        <label class="flex justify-between font-bold text-gray-700 mb-4 uppercase text-sm tracking-wider">
                             <span><i class="fas fa-microphone-alt mr-2 text-red-500"></i>Impacto del Pitch</span>
                            <span class="text-red-600 font-black" id="val-4">3/5</span>
                        </label>
                        <input type="range" class="w-full h-4 bg-gray-300 rounded-full appearance-none cursor-pointer accent-red-500" min="1" max="5" step="1" value="3" oninput="document.getElementById('val-4').innerText = this.value + '/5'">
                         <div class="flex justify-between text-xs text-gray-500 mt-2 font-bold uppercase"><span>Aburrido</span><span>Memorable</span></div>
                    </div>
                </div>

                <button onclick="app.playSound('success'); app.submitEvaluation()" class="mt-10 udd-gradient w-full text-white font-bold text-xl py-4 rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] transition flex items-center justify-center">
                    <i class="fas fa-paper-plane mr-3"></i> Enviar Feedback y Finalizar
                </button>
            </div>
        </section>

        <!-- 8. ETAPA 6: CIERRE Y PODIO FINAL -->
        <!-- ... (Contenido de Etapa 6 omitido para brevedad, no hay cambios aquí) ... -->
        <section id="view-stage6" class="fade-in text-center py-10">
             <!-- Confeti Canvas (Placeholder) -->
            <div class="game-card p-10 rounded-3xl shadow-2xl max-w-4xl mx-auto relative overflow-hidden bg-gradient-to-b from-white to-gray-100">
                
                <i class="fas fa-crown text-7xl text-yellow-400 mb-4 animate-bounce shadow-sm"></i>
                <h2 class="text-5xl font-bold text-gray-800 mb-4 gamer-font">¡Misión Cumplida!</h2>
                <p class="text-xl text-gray-600 mb-12 font-semibold">Clasificación Final de Escuadrones</p>

                <!-- PODIO FINAL ANIMADO -->
                <div class="flex justify-center items-end h-64 mb-16 space-x-4 px-4">
                    <!-- 2nd Place -->
                    <div class="flex flex-col items-center slide-up" style="animation-delay: 0.2s;">
                        <div class="text-gray-600 font-bold mb-2">Equipo Beta</div>
                         <div class="w-24 md:w-32 h-32 bg-gradient-to-t from-gray-400 to-gray-300 rounded-t-lg shadow-lg flex flex-col justify-end p-4 border-t-4 border-gray-500 relative">
                            <div class="absolute -top-5 left-1/2 transform -translate-x-1/2 bg-gray-200 rounded-full w-10 h-10 flex items-center justify-center font-bold border-2 border-gray-400">2</div>
                            <span class="text-2xl font-bold text-gray-800">12</span>
                            <span class="text-xs font-bold text-gray-600 uppercase"><i class="fas fa-coins"></i> Tokens</span>
                        </div>
                    </div>
                     <!-- 1st Place (Winner) -->
                    <div class="flex flex-col items-center slide-up relative z-10" style="animation-delay: 0.4s;">
                         <i class="fas fa-trophy text-5xl text-yellow-400 absolute -top-14 animate-bounce-slow filter drop-shadow-lg"></i>
                        <div class="text-yellow-600 font-bold mb-2 text-xl" id="result-team-name">Tu Equipo</div>
                        <div class="w-28 md:w-40 h-48 bg-gradient-to-t from-yellow-400 to-yellow-300 rounded-t-lg shadow-2xl flex flex-col justify-end p-4 border-t-4 border-yellow-500 relative">
                             <div class="absolute -top-6 left-1/2 transform -translate-x-1/2 bg-yellow-100 rounded-full w-12 h-12 flex items-center justify-center font-bold text-xl border-4 border-yellow-400 text-yellow-700">1</div>
                            <span class="text-4xl font-bold text-yellow-900" id="result-tokens">0</span>
                            <span class="text-sm font-bold text-yellow-800 uppercase"><i class="fas fa-coins"></i> Tokens</span>
                        </div>
                    </div>
                     <!-- 3rd Place -->
                    <div class="flex flex-col items-center slide-up" style="animation-delay: 0.6s;">
                        <div class="text-yellow-700 font-bold mb-2">Equipo Gamma</div>
                         <div class="w-24 md:w-32 h-40 bg-gradient-to-t from-yellow-600 to-yellow-500 rounded-t-lg shadow-lg flex flex-col justify-end p-4 border-t-4 border-yellow-700 relative">
                            <div class="absolute -top-5 left-1/2 transform -translate-x-1/2 bg-yellow-600 rounded-full w-10 h-10 flex items-center justify-center font-bold text-white border-2 border-yellow-800">3</div>
                            <span class="text-2xl font-bold text-white">8</span>
                            <span class="text-xs font-bold text-yellow-200 uppercase"><i class="fas fa-coins"></i> Tokens</span>
                        </div>
                    </div>
                </div>

                <!-- Perfil de Habilidades -->
                <div class="bg-gray-800 bg-opacity-5 backdrop-filter backdrop-blur p-8 rounded-2xl mb-8 border-2 border-white/50">
                    <h3 class="font-bold text-2xl mb-4 gamer-font text-gray-800"><i class="fas fa-chart-radar mr-3 text-pink-500"></i>Tu Perfil Emprendedor Adquirido</h3>
                    <p class="text-gray-600 text-center font-semibold">Selecciona las habilidades que subieron de nivel hoy:</p>
                    <div class="flex flex-wrap items-center gap-3">
                        <button onclick="this.classList.toggle('bg-pink-500'); this.classList.toggle('text-white'); app.playSound('click')" class="px-6 py-2 border-2 border-pink-500 text-pink-500 font-bold rounded-full hover:bg-pink-100 transition">Liderazgo y Visión</button>
                        <button onclick="this.classList.toggle('bg-blue-500'); this.classList.toggle('text-white'); app.playSound('click')" class="px-6 py-2 border-2 border-blue-500 text-blue-500 font-bold rounded-full hover:bg-blue-100 transition">Prototipado Ágil</button>
                        <button onclick="this.classList.toggle('bg-green-500'); this.classList.toggle('text-white'); app.playSound('click')" class="px-6 py-2 border-2 border-green-500 text-green-500 font-bold rounded-full hover:bg-green-100 transition">Resiliencia</button>
                        <button onclick="this.classList.toggle('bg-red-500'); this.classList.toggle('text-white'); app.playSound('click')" class="px-6 py-2 border-2 border-red-500 text-red-500 font-bold rounded-full hover:bg-red-100 transition">Comunicación de Alto Impacto</button>
                         <button onclick="this.classList.toggle('bg-purple-500'); this.classList.toggle('text-white'); app.playSound('click')" class="px-6 py-2 border-2 border-purple-500 text-purple-500 font-bold rounded-full hover:bg-purple-100 transition">Empatía Profunda</button>
                    </div>
                </div>

                <button onclick="app.playSound('click'); app.resetGame(); app.showView('view-welcome')" class="udd-gradient w-full text-white font-bold text-xl py-4 rounded-xl shadow-lg hover:shadow-xl hover:scale-[1.02] transition disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100" id="btn-start-game">
                    <i class="fas fa-check-circle mr-2"></i> Volver al inicio
                </button>
                
                <p class="text-sm text-gray-500 font-semibold">Gracias por jugar MisiónEmprende</p>
            </div>
        </section>

        <section id="view-professor" class="hidden fade-in min-h-screen bg-slate-900 flex flex-col relative overflow-hidden rounded-medium">
    
            <div class="absolute inset-0 pointer-events-none overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-full bg-[radial-gradient(ellipse_at_center,_var(--tw-gradient-stops))] from-purple-900/40 via-gray-900 to-gray-900"></div>
                <div class="absolute -top-20 -right-20 w-96 h-96 bg-pink-600/20 rounded-full blur-3xl animate-pulse-slow"></div>
                <div class="absolute -bottom-20 -left-20 w-96 h-96 bg-blue-600/20 rounded-full blur-3xl animate-pulse-slow" style="animation-delay: 1s;"></div>
            </div>
        
            <div class="relative z-10 bg-gray-900/80 backdrop-blur-md border-b border-gray-700 p-4 flex justify-between items-center">
                <div class="flex items-center gap-3">
                    <img src="{% static 'misionemprende/img/shlam.png' %}" class="h-8 opacity-80">
                    <span class="text-white font-bold border-l border-gray-600 pl-3">Profesor</span>
                </div>
                <button onclick="app.showView('view-welcome')" class="text-gray-400 hover:text-white transition"><i class="fas fa-times"></i></button>
            </div>
        
            <div class="relative z-10 flex-grow flex flex-col items-center justify-center text-center p-4">
                <p class="text-pink-400 font-bold tracking-[0.3em] uppercase mb-4 animate-bounce">¿Están listos?</p>
                
                <div class="bg-white text-gray-900 p-8 md:p-12 rounded-3xl shadow-[0_0_60px_rgba(255,255,255,0.3)] transform hover:scale-105 transition duration-500 relative group cursor-pointer" onclick="app.copyCode()">
                    <div class="absolute -top-3 -right-3 bg-yellow-400 text-yellow-900 text-xs font-bold px-3 py-1 rounded-full shadow-lg">CÓDIGO DE SESIÓN</div>
                    
                    <h1 id="prof-session-code" class="text-6xl md:text-8xl font-black tracking-tighter gamer-font">LOADING...</h1>
                    
                </div>
        
                <p class="text-gray-400 mt-8 text-lg">Esperando a que los equipos se conecten...</p>
            </div>
        
            <div class="relative z-10 bg-gray-800/80 backdrop-blur border-t border-gray-700 h-1/3 min-h-[250px] p-6 overflow-y-auto">
                <div class="flex justify-between items-end mb-6">
                    <h3 class="text-2xl text-white font-bold gamer-font"><i class="fas fa-users mr-2 text-blue-400"></i> Grupos en línea (<span id="prof-team-count">0</span>)</h3>
                    <button class="bg-green-500 hover:bg-green-600 text-white font-bold py-2 px-6 rounded-full shadow-lg hover:shadow-green-500/50 transition">
                        INICIAR CONTEO MANUAL TOKENS <i class="fas fa-coins mr-2 animate-pulse"></i> 
                    </button>
                </div>
        
                <div id="prof-teams-grid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                    </div>
            </div>
        </section>

        <!-- VISTA DE TRANSICIÓN ENTRE ETAPAS -->
        <section id="view-transition" class="hidden fixed inset-0 z-[100] items-center justify-center bg-slate-900/95 backdrop-blur-md fade-in">
    
            <div class="absolute w-full h-full overflow-hidden pointer-events-none">
                <div class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-[500px] h-[500px] bg-pink-600/20 rounded-full blur-[100px] animate-pulse-slow"></div>
            </div>
        
            <div class="relative bg-gray-900 border border-gray-700 p-10 rounded-[2rem] shadow-[0_0_50px_rgba(212,15,125,0.4)] max-w-lg w-full mx-4 text-center transform transition-all scale-100 overflow-hidden">
                
                <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-pink-500 to-transparent"></div>
        
                <div class="relative mb-6 inline-block">
                    <div class="absolute inset-0 bg-pink-500 blur-xl opacity-50 animate-pulse"></div>
                    <div class="relative bg-gradient-to-br from-gray-800 to-black w-24 h-24 rounded-full flex items-center justify-center border-2 border-pink-500/50 shadow-lg z-10">
                        <i class="fas fa-rocket text-5xl text-transparent bg-clip-text bg-gradient-to-t from-pink-500 to-white animate-bounce-slow"></i>
                    </div>
                </div>
                
                <h2 id="trans-title" class="text-4xl md:text-5xl font-bold mb-2 gamer-font text-transparent bg-clip-text bg-gradient-to-r from-white via-pink-200 to-white drop-shadow-sm">
                    ¡Misión Cumplida!
                </h2>
                
                <div class="flex justify-center mb-8">
                    <div class="h-1 w-20 bg-gray-700 rounded-full"></div>
                </div>
                <p id="trans-desc" class="text-lg text-blue-200 font-medium mb-10 tracking-wide">
                    Procesando datos del escuadrón...
                </p>
        
                <div class="relative flex items-center justify-center mx-auto w-24 h-24">
                    <div class="absolute w-full h-full border-4 border-t-pink-500 border-r-transparent border-b-purple-500 border-l-transparent rounded-full animate-spin-slow"></div>
                    <div class="absolute w-3/4 h-3/4 border-2 border-t-transparent border-r-white border-b-transparent border-l-white rounded-full animate-spin-reverse opacity-50"></div>
                    
                    <div class="w-16 h-16 bg-gray-800 rounded-full flex items-center justify-center shadow-inner z-10">
                        <span id="trans-countdown" class="text-3xl font-bold text-white gamer-font">5</span>
                    </div>
                </div>
        
                <p class="text-xs text-gray-500 mt-6 uppercase tracking-widest animate-pulse">Cargando Siguiente Fase...</p>
        
            </div>
        </section>
    </main>

    <!-- Elementos de Audio (Placeholders - Reemplazar 'src' con archivos reales en Django) -->
    <audio id="sfx-click" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3" preload="auto"></audio>
    <audio id="sfx-success" src="https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3" preload="auto"></audio>
    <audio id="sfx-countdown" src="https://assets.mixkit.co/active_storage/sfx/2003/2003-preview.mp3" preload="auto"></audio>
    <audio id="sfx-fanfare" src="https://assets.mixkit.co/active_storage/sfx/2020/2020-preview.mp3" preload="auto"></audio>
    <audio id="sfx-error" src="https://assets.mixkit.co/active_storage/sfx/2573/2573-preview.mp3" preload="auto"></audio>

    <!-- Script Lógica de la Aplicación -->
    <script src="{% static 'misionemprende/js/main2.js' %}"></script>
</body>
</html>